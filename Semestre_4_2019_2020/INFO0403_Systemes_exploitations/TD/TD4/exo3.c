/*
        exercice 1
    mettre en place le systeme suivant:
        3 processus un père, 2 fils A et B
        A et B communiquent de manière symétrique
    A demande un entier x à l'utilisateur et l'envoie à B. 
    R repond à A si X est pair ou impaire.
    A affiche le resultat.
    On recommence tant que X>= 0
*/
#include <time.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/wait.h>
int main(int argc,char*argv[]){
    int x,rep;
    int AvB[2],BvA[2];
    pipe(&AvB[0]);
    pipe(&BvA[0]);
    if(fork()==0){
        //  A
        close(AvB[0]);
        close(BvA[1]);
        printf("entrez un nombre :");
        scanf("%d",&x);
        while(x>=0){
            write(AvB[1],&x,sizeof(int));
            read(BvA[0],&rep,sizeof(int));
            if(rep==0){
                printf("%d impaire \n",x);
            }
            else{
                printf("%d pair \n",x);
            }
            printf("entrez un nombre :");
            scanf("%d",&x);
        }
        write(AvB[1],&x,sizeof(int));
        sleep(3);
        close(AvB[1]);
        close(BvA[0]);
        _exit(0);
    }
    if(fork()==0){
        //  B
        close(BvA[0]);
        close(AvB[1]);
        read(AvB[0],&x,sizeof(int));
        while(x>=0){
            if(x%2==0){
                rep=1;
            }
            else{
                rep=0;
            }
            write(BvA[1],&rep,sizeof(int));
            read(AvB[0],&x,sizeof(int));
        }
        close(BvA[1]);
        close(AvB[0]);
        _exit(0);
    }
    //père
    close(AvB[0]);
    close(AvB[1]);
    close(BvA[0]);
    close(BvA[1]);
    wait(NULL);
    wait(NULL);
    _exit(0);
}